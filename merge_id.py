import requests
import re
import logging
import pandas as pd
import time
from collections import defaultdict

# Freshdesk credentials and domain
API_KEY = '5TMgbcZdRFY70hSpEdj'
DOMAIN = 'benchmarkeducationcompany.freshdesk.com'

# Freshdesk API URL and headers
headers = {
    "Content-Type": "application/json"
}

STATUS_MAPPING = {
    2: 'Open',
    3: 'Pending',
    4: 'Resolved',
    5: 'Closed'
}

# Setup logging
logging.basicConfig(level=logging.INFO, format='%(asctime)s - %(levelname)s - %(message)s')

# Function to extract merged ticket IDs from the conversation body
def extract_merged_ticket_ids(conversation_body):
    merged_ticket_ids = re.findall(r'https://benchmarkeducationcompany\.freshdesk\.com\/a\/tickets\/(\d+)', conversation_body)
    return merged_ticket_ids

# Function to get all conversations for a given ticket ID
def get_conversations_for_ticket(ticket_id):
    conversations_url = f"https://{DOMAIN}/api/v2/tickets/{ticket_id}/conversations"
    response = requests.get(conversations_url, auth=(API_KEY, 'X'), headers=headers)

    if response.status_code == 200:
        conversations = response.json()
        merged_ticket_ids = []

        for conversation in conversations:
            merged_ticket_ids.extend(extract_merged_ticket_ids(conversation['body']))

        return list(set(merged_ticket_ids))  # Return unique ticket IDs
    else:
        logging.error(f"Failed to retrieve conversations for ticket {ticket_id}: {response.status_code} - {response.text}")
        return []

# Function to get details of a specific ticket including subject and tags
def get_ticket_details(ticket_id):
    ticket_url = f"https://{DOMAIN}/api/v2/tickets/{ticket_id}"
    response = requests.get(ticket_url, auth=(API_KEY, 'X'), headers=headers)

    if response.status_code == 200:
        ticket = response.json()
        return {
            'ticket_id': ticket['id'],
            'created_at': ticket['created_at'],
            'status': STATUS_MAPPING.get(ticket['status'], f"Unknown ({ticket['status']})"),
            'subject': ticket.get('subject', 'No Subject'),
            'tags': ', '.join(ticket.get('tags', []))  # Combine tags into a single string
        }
    else:
        logging.error(f"Failed to retrieve details for ticket {ticket_id}: {response.status_code} - {response.text}")
        return None

# Main function to extract merged tickets and save to Excel
def extract_merged_tickets(ticket_ids, all_tickets_data):
    grouped_tickets = defaultdict(list)

    for ticket_id in ticket_ids:
        merged_tickets = get_conversations_for_ticket(ticket_id)
        if merged_tickets:
            for merged_ticket_id in merged_tickets:
                ticket_details = get_ticket_details(merged_ticket_id)
                if ticket_details:
                    grouped_tickets[ticket_id].append({
                        'ticket_id': ticket_details['ticket_id'],
                        'created_at': ticket_details['created_at'],
                        'status': ticket_details['status'],
                        'subject': ticket_details['subject'],
                        'tags': ticket_details['tags']
                    })
                    
                    # Add data to all_tickets_data for Excel output
                    all_tickets_data.append({
                        'Original Ticket ID': ticket_id,
                        'Merged Ticket ID': ticket_details['ticket_id'],
                        'Created At': ticket_details['created_at'],
                        'Status': ticket_details['status'],
                        'Subject': ticket_details['subject'],
                        'Tags': ticket_details['tags']
                    })

        # Add a delay to avoid hitting rate limits
        time.sleep(1)

if __name__ == '__main__':
    # List of ticket IDs to process
    ticket_ids = [
264875, 
264877, 
264878, 
264879, 
264880, 
264884, 
264886, 
264887, 
264888, 
264889, 
264890, 
264891, 
264892, 
264893, 
264894, 
264925, 
264926, 
264927, 
264928, 
264948, 
264952, 
264953, 
264954, 
264955, 
264956, 
264957, 
264958, 
264959, 
264960, 
264961, 
264962, 
264963, 
264964, 
264965, 
264966, 
264967, 
264968, 
264969, 
264970, 
264972, 
264973, 
264974, 
264980, 
264981, 
265001, 
265004, 
265020, 
265021, 
265022, 
265023, 
265029, 
265032, 
265037, 
265043, 
265073, 
265087, 
265099, 
265100, 
265105, 
265106, 
265107, 
265108, 
265109, 
265112, 
265126, 
265135, 
265136, 
265142, 
265143, 
265144, 
265145, 
265146, 
265147, 
265148, 
265165, 
265173, 
265174, 
265226, 
265230, 
265239, 
265240, 
265241, 
265244, 
265245, 
265267, 
265293, 
265294, 
265295, 
265296, 
265297, 
265298, 
265299, 
265300, 
265301, 
265319, 
265320, 
265323, 
265324, 
265325, 
265326, 
265327, 
265349, 
265354, 
265355, 
265364, 
265366, 
265367, 
265368, 
265369, 
265370, 
265373, 
265374, 
265376, 
265377, 
265378, 
265379, 
265380, 
265382, 
265383, 
265391, 
265392, 
265393, 
265394, 
265396, 
265397, 
265398, 
265399, 
265406, 
265407, 
265408, 
265409, 
265410, 
265411, 
265412, 
265413, 
265414, 
265415, 
265416, 
265417, 
265418, 
265419, 
265420, 
265421, 
265422, 
265423, 
265424, 
265428, 
265429, 
265432, 
265433, 
265434, 
265435, 
265436, 
265437, 
265438, 
265439, 
265440, 
265442, 
265443, 
265444, 
265446, 
265448, 
265449, 
265450, 
265451, 
265452, 
265453, 
265454, 
265455, 
265456, 
265457, 
265458, 
265459, 
265460, 
265461, 
265462, 
265463, 
265464, 
265465, 
265466, 
265467, 
265468, 
265469, 
265470, 
265471, 
265472, 
265473, 
265489, 
267396, 
267397, 
267398, 
267399, 
267400, 
267401, 
267402, 
267403, 
267404, 
267405, 
267406, 
267982, 
267983, 
267984, 
267985, 
267986, 
267987, 
267988, 
267989, 
267990, 
267991, 
267992, 
267993, 
267994, 
267995, 
267996, 
267997, 
267998, 
267999, 
268000, 
268001, 
268002, 
268003, 
268004, 
268012, 
268013, 
268034, 
268035, 
268038, 
268040, 
268041, 
268042, 
268043, 
268044, 
268076, 
268077, 
268079, 
268080, 
268081, 
268082, 
268083, 
268084, 
268085, 
268086, 
268092, 
268097, 
268103, 
268104, 
268105, 
268106, 
268107, 
268108, 
268109, 
268110, 
268111, 
268116, 
268127, 
268128, 
268138, 
268139, 
268150, 
268151, 
268152, 
268153, 
268154, 
268155, 
268156, 
268157, 
268158, 
268159, 
268160, 
268162, 
268163, 
268164, 
268167, 
268168, 
268169, 
268173, 
268174, 
268175, 
268176, 
268177, 
268178, 
268179, 
268180, 
268185, 
268186, 
268187, 
268188, 
268189, 
268191, 
268192, 
268222, 
268224, 
268225, 
268226, 
268227, 
268228, 
268237, 
268245, 
268251, 
268259, 
268260, 
268261, 
268262, 
268263, 
268264, 
268265, 
268269, 
268270, 
268278, 
268279, 
268280, 
268281, 
268282, 
268283, 
268284, 
268295, 
268298, 
268299, 
268300, 
268301, 
268322, 
268324, 
268325, 
268326, 
268343, 
268345, 
268365, 
268372, 
268373, 
268382, 
268383, 
268384, 
268390, 
268391, 
268392, 
268393, 
268394, 
268395, 
268396, 
268397, 
268398, 
268399, 
268411, 
268425, 
268426, 
268427, 
268428, 
268429, 
268430, 
268433, 
268434, 
268435, 
268436, 
268437, 
268441, 
268442, 
268443, 
268444, 
268447, 
268448, 
268455, 
268456, 
268457, 
268460, 
268461, 
268464, 
268473, 
268474, 
268475, 
268476, 
268479, 
268480, 
268481, 
268482, 
268483, 
268484, 
268485, 
268486, 
268487, 
268488, 
268489, 
268506, 
268507, 
268508, 
268509, 
268510, 
268511, 
268512, 
268513, 
268514, 
268515, 
268516, 
268517, 
268519, 
268521, 
268522, 
268523, 
268524, 
268525, 
268526, 
268527, 
268528, 
268529, 
268530, 
268537, 
268540, 
268546, 
268547, 
268558, 
268559, 
268560, 
268561, 
268562, 
268563, 
268564, 
268565, 
268566, 
268567, 
268568, 
268584, 
268585, 
268595, 
268599, 
268600, 
268601, 
268602, 
268603, 
268604, 
268605, 
268606, 
268607, 
268608, 
268609, 
268610, 
268611, 
268612, 
268616, 
268617, 
268618, 
268619, 
268620, 
268622, 
268623, 
268624, 
268625, 
268626, 
268627, 
268628, 
268629, 
268630, 
268632, 
268633, 
268634, 
268635, 
268636, 
268637, 
268638, 
268639, 
268640, 
268641, 
268643, 
268645, 
268646, 
268647, 
268648, 
268649, 
268652, 
268654, 
268655, 
268659, 
268683, 
268690, 
268703, 
268709, 
268717, 
268718, 
268726, 
268727, 
268739, 
268740, 
268741, 
268742, 
268743, 
268744, 
268745, 
268746, 
268748, 
268749, 
268750, 
268751, 
268752, 
268765, 
268766, 
268767, 
268768, 
268769, 
268770, 
268771, 
268772, 
268773, 
268774, 
268775, 
268776, 
268777, 
268779, 
268780, 
268781, 
268782, 
268783, 
268784, 
268785, 
268786, 
268787, 
268788, 
268789, 
268790, 
268791, 
268792, 
268793, 
268794, 
268795, 
268796, 
268797, 
268798, 
268800, 
268801, 
268802, 
268803, 
268804, 
268805, 
268806, 
268809, 
268814, 
268815, 
268816, 
268817, 
268818, 
268819, 
268829, 
268830, 
268834, 
268839, 
268845, 
268853, 
268857, 
268861, 
268875, 
268899, 
268900, 
268901, 
268908, 
268909, 
268910, 
268911, 
268912, 
268917, 
268918, 
268919, 
268920, 
268921, 
268922, 
268923, 
268924, 
268925, 
268926, 
268927, 
268928, 
268929, 
268930, 
268931, 
268932, 
268933, 
268934, 
268935, 
268936, 
268937, 
268938, 
268952, 
268953, 
268954, 
268955, 
268956, 
268957, 
268958, 
268961, 
268962, 
269008, 
269015, 
269020, 
269021, 
269022, 
269023, 
269024, 
269033, 
269034, 
269035, 
269037, 
269061, 
269071, 
269072, 
269073, 
269084, 
269094, 
269098, 
269122, 
269124, 
269125, 
269128, 
269131, 
269134, 
269141, 
269150, 
269151, 
269152, 
269153, 
269154, 
269155, 
269156, 
269157, 
269158, 
269159, 
269160, 
269161, 
269162, 
269163, 
269164, 
269165, 
269166, 
269167, 
269168, 
269193, 
269194, 
269204, 
269212, 
269213, 
269214, 
269215, 
269233, 
269241, 
269242, 
269243, 
269244, 
269245, 
269246, 
269247, 
269248, 
269249, 
269250, 
269251, 
269252, 
269253, 
269254, 
269255, 
269256, 
269257, 
269258, 
269260, 
269262, 
269264, 
269265, 
269266, 
269267, 
269271, 
269272, 
269273, 
269274, 
269275, 
269284, 
269285, 
269286, 
269287, 
269288, 
269289, 
269290, 
269291, 
269292, 
269293, 
269294, 
269295, 
269296, 
269297, 
269298, 
269299, 
269300, 
269301, 
269302, 
269303, 
269304, 
269305, 
269306, 
269307, 
269308, 
269309, 
269310, 
269311, 
269312, 
269313, 
269314, 
269315, 
269316, 
269317, 
269318, 
269319, 
269320, 
269321, 
269322, 
269324, 
269326, 
269327, 
269330, 
269331, 
269332, 
269333, 
269334, 
269335, 
269336, 
269337, 
269340, 
269346, 
269350, 
269353, 
269367, 
269368, 
269369, 
269370, 
269387, 
269388, 
269389, 
269390, 
269391, 
269392, 
269393, 
269394, 
269395, 
269396, 
269397, 
269398, 
269399, 
269400, 
269401, 
269402, 
269403, 
269404, 
269405, 
269406, 
269407, 
269408, 
269409, 
269410, 
269411, 
269412, 
269413, 
269414, 
269415, 
269416, 
269417, 
269418, 
269420, 
269421, 
269423, 
269424, 
269425, 
269426, 
269427, 
269428, 
269429, 
269430, 
269431, 
269437, 
269438, 
269616, 
269632, 
269633, 
269634, 
269638, 
269639, 
269650, 
269651, 
269652, 
269662, 
269663, 
269664, 
269665, 
269666, 
269671, 
269678, 
269680, 
269681, 
269691, 
269710, 
269711, 
269712, 
269713, 
269716, 
269717, 
269718, 
269719, 
269720, 
269721, 
269722, 
269723, 
269724, 
269725, 
269726, 
269727, 
269728, 
269733, 
269734, 
269735, 
269738, 
269739, 
269740, 
269741, 
269752, 
269753, 
269754, 
269755, 
269763, 
269769, 
269770, 
269771, 
269772, 
269773, 
269774, 
269775, 
269776, 
269777, 
269790, 
269795, 
269798, 
269799, 
269800, 
269801, 
269802, 
269851, 
269858, 
269862, 
269863, 
269864, 
269865, 
269866, 
269867, 
269868, 
269869, 
269870, 
269871, 
269874, 
269875, 
269876, 
269877, 
269880, 
269884, 
269889, 
269890, 
269893, 
269905, 
269906, 
269907, 
269908, 
269910, 
269916, 
269917, 
269918, 
269919, 
269920, 
269925, 
269926, 
269927, 
269934, 
269935, 
269936, 
269950, 
269952, 
269953, 
269964, 
269968, 
269969, 
269970, 
269971, 
269975, 
269978, 
269979, 
269980, 
269981, 
269984, 
269985, 
269986, 
269987, 
269990, 
269991, 
269992, 
269996, 
269997, 
269998, 
269999, 
270000, 
270004, 
270005, 
270009, 
270010, 
270011, 
270023, 
270029, 
270032, 
270033, 
270034, 
270035, 
270037, 
270072, 
270075, 
270080, 
270081, 
270082, 
270083, 
270084, 
270085, 
270086, 
270087, 
270088, 
270089, 
270090, 
270091, 
270092, 
270093, 
270094, 
270095, 
270096, 
270097, 
270098, 
270099, 
270100, 
270101, 
270102, 
270103, 
270104, 
270105, 
270108, 
270109, 
270111, 
270112, 
270117, 
270120, 
270133, 
270150, 
270151, 
270164, 
270165, 
270166, 
270167, 
270168, 
270169, 
270170, 
270171, 
270172, 
270173, 
270174, 
270175, 
270176, 
270177, 
270178, 
270179, 
270180, 
270181, 
270182, 
270183, 
270184, 
270185, 
270186, 
270187, 
270189, 
270190, 
270191, 
270192, 
270193, 
270194, 
270197, 
270198, 
270199, 
270200, 
270201, 
270202, 
270217, 
270218, 
270219, 
270220, 
270221, 
270222, 
270225, 
270229, 
270235, 
270338, 
270339, 
270340, 
270342, 
270384, 
270385, 
270386, 
270387, 
270388, 
270389, 
270390, 
270397, 
270398, 
270404, 
270405, 
270408, 
270409, 
270418, 
270419, 
270420, 
270421, 
270422, 
270423, 
270424, 
270436, 
270437, 
270438, 
270439, 
270440, 
270448, 
270449, 
270450, 
270460, 
270484, 
270487, 
270488, 
270503, 
270504, 
270505, 
270515, 
270516, 
270517, 
270523, 
270525, 
270526, 
270527, 
270528, 
270530, 
270531, 
270533, 
270534, 
270535, 
270536, 
270537, 
270538, 
270539, 
270540, 
270541, 
270542, 
270543, 
270544, 
270545, 
270546, 
270547, 
270548, 
270549, 
270550, 
270551, 
270552, 
270553, 
270554, 
270555, 
270556, 
270557, 
270558, 
270559, 
270560, 
270561, 
270562, 
270563, 
270566, 
270567, 
270568, 
270569, 
270570, 
270571, 
270576, 
270577, 
270581, 
270582, 
270583, 
270584, 
270585, 
270692, 
270711, 
270712, 
270720, 
270726, 
270727, 
270739, 
270766, 
270774, 
270779, 
270780, 
270781, 
270782, 
270783, 
270784, 
270785, 
270786, 
270787, 
270812, 
270834, 
270835, 
270836, 
270841, 
270842, 
270843, 
270844, 
270845, 
270851, 
270852, 
270857, 
270858, 
270863, 
270864, 
270865, 
270866, 
270867, 
270868, 
270869, 
270870, 
270871, 
270872, 
270873, 
270874, 
270876, 
270877, 
270878, 
270879, 
270880, 
270881, 
270882, 
270883, 
270884, 
270885, 
270886, 
270887, 
270888, 
270890, 
270891, 
270892, 
270893, 
270894, 
270895, 
270896, 
270897, 
270898, 
270899, 
270900, 
270901, 
270902, 
270917, 
270918, 
270919, 
270920, 
270921, 
270922, 
270923, 
270924, 
270925, 
270926, 
270927, 
270928, 
270929, 
270930, 
270931, 
270932, 
270933, 
270934, 
270935, 
270936, 
270937, 
270938, 
270939, 
270943, 
270944, 
270945, 
270946, 
270947, 
270948, 
270949, 
270950, 
270951, 
270952, 
270953, 
270954, 
270955, 
270957, 
270958, 
270959, 
270960, 
270961, 
270962, 
270963, 
270964, 
270965, 
270966, 
270967, 
270968, 
270977, 
270978, 
270979, 
270980, 
270981, 
270982, 
270983, 
270987, 
270988, 
270989, 
270990, 
270991, 
270992, 
270993, 
270994, 
270995, 
270996, 
270999, 
271000, 
271001, 
271002, 
271003, 
271004, 
271005, 
271068, 
271069, 
271070, 
271071, 
271072, 
271073, 
271074, 
271075, 
271076, 
271077, 
271078, 
271079, 
271080, 
271081, 
271082, 
271083, 
271084, 
271085, 
271086, 
271087, 
271088, 
271089, 
271090, 
271091, 
271092, 
271093, 
271094, 
271098, 
271099, 
271105, 
271106, 
271107, 
271108, 
271109, 
271114, 
271115, 
271116, 
271117, 
271118, 
271119, 
271120, 
271121, 
271122, 
271129, 
271130, 
271131, 
271132, 
271133, 
271134, 
271135, 
271136, 
271137, 
271138, 
271159, 
271160, 
271161, 
271169, 
271175, 
271176, 
271177, 
271185, 
271193, 
271194, 
271195, 
271196, 
271205, 
271211, 
271214, 
271233, 
271234, 
271235, 
271241, 
271242, 
271260, 
271263, 
271279, 
271281, 
271282, 
271283, 
271284, 
271285, 
271286, 
271287, 
271288, 
271289, 
271290, 
271291, 
271295, 
271296, 
271297, 
271300, 
271305, 
271306, 
271307, 
271308, 
271309, 
271310, 
271311, 
271312, 
271313, 
271314, 
271315, 
271316, 
271317, 
271318, 
271319, 
271320, 
271321, 
271325, 
271326, 
271327, 
271332, 
271333, 
271334, 
271335, 
271344, 
271345, 
271346, 
271347, 
271348, 
271349, 
271350, 
271351, 
271353, 
271354, 
271355, 
271356, 
271357, 
271358, 
271359, 
271360, 
271361, 
271362, 
271363, 
271368, 
271369, 
271370, 
271371, 
271372, 
271373, 
271374, 
271376, 
271377, 
271378, 
271379, 
271380, 
271382, 
271383, 
271384, 
271385, 
271386, 
271387, 
271388, 
271389, 
271390, 
271391, 
271392, 
271393, 
271394, 
271395, 
271397, 
271398, 
271399, 
271400, 
271401, 
271402, 
271403, 
271404, 
271405, 
271406, 
271407, 
271414, 
271415, 
271416, 
271519, 
271529, 
271541, 
271542, 
271543, 
271544, 
271545, 
271549, 
271550, 
271551, 
271552, 
271553, 
271554, 
271555, 
271556, 
271575, 
271576, 
271595, 
271596, 
271597, 
271598, 
271599, 
271600, 
271601, 
271602, 
271603, 
271604, 
271605, 
271606, 
271607, 
271608, 
271613, 
271614, 
271615, 
271616, 
271617, 
271618, 
271619, 
271620, 
271621, 
271622, 
271623, 
271624, 
271625, 
271633, 
271634, 
271635, 
271636, 
271640, 
271641, 
271642, 
271643, 
271644, 
271645, 
271667, 
271668, 
271669, 
271670, 
271671, 
271673, 
271681, 
271682, 
271683, 
271684, 
271685, 
271686, 
271687, 
271695, 
271696, 
271697, 
271704, 
271709, 
271710, 
271711, 
271712, 
271713, 
271719, 
271722, 
271723, 
271724, 
271725, 
271726, 
271727, 
271728, 
271729, 
271730, 
271731, 
271732, 
271733, 
271739, 
271740, 
271741, 
271742, 
271743, 
271750, 
271751, 
271752, 
271753, 
271754, 
271755, 
271759, 
271760, 
271761, 
271762, 
271763, 
271764, 
271765, 
271766, 
271767, 
271768, 
271769, 
271777, 
271779, 
271780, 
271781, 
271782, 
271783, 
271784, 
271785, 
271786, 
271787, 
271788, 
271789, 
271790, 
271791, 
271792, 
271794, 
271795, 
271796, 
271797, 
271798, 
271869, 
271870, 
271871, 
271872, 
271873, 
271874, 
271875, 
271876, 
271877, 
271878, 
271879, 
271880, 
271881, 
271882, 
271883, 
271884, 
271885, 
271886, 
271887, 
271888, 
271889, 
271890, 
271891, 
271892, 
271893, 
271894, 
271895, 
271898, 
271899, 
271900, 
271901, 
271902, 
271903, 
271904, 
271905, 
271906, 
271910, 
271914, 
271915, 
271916, 
271922, 
271923, 
271924, 
271925, 
271970, 
271971, 
271978, 
271979, 
271980, 
271981, 
271982, 
271983, 
271984, 
271985, 
271986, 
271987, 
271988, 
271989, 
271990, 
271991, 
271992, 
271993, 
271994, 
271995, 
271996, 
271997, 
271998, 
271999, 
272000, 
272001, 
272002, 
272003, 
272004, 
272005, 
272006, 
272007, 
272008, 
272009, 
272010, 
272011, 
272012, 
272016, 
272031, 
272032, 
272052, 
272053, 
272071, 
272072, 
272073, 
272074, 
272075, 
272076, 
272077, 
272078, 
272079, 
272080, 
272081, 
272082, 
272083, 
272084, 
272087, 
272177, 
272178, 
272180, 
272181, 
272182, 
272183, 
272184, 
272185, 
272186, 
272187, 
272188, 
272189, 
272190, 
272191, 
272192, 
272193, 
272194, 
272195, 
272196, 
272197, 
272198, 
272199, 
272200, 
272201, 
272202, 
272203, 
272204, 
272205, 
272206, 
272207, 
272208, 
272209, 
272210, 
272211, 
272212, 
272213, 
272214, 
272215, 
272216, 
272217, 
272218, 
272219, 
272220, 
272221, 
272222, 
272223, 
272224, 
272225, 
272231, 
272232, 
272233, 
272234, 
272235, 
272236, 
272237, 
272238, 
272239, 
272240, 
272241, 
272242, 
272243, 
272244, 
272245, 
272246, 
272247, 
272248, 
272249, 
272250, 
272251, 
272252, 
272253, 
272254, 
272255, 
272256, 
272257, 
272258, 
272259, 
272260, 
272261, 
272262, 
272263, 
272274, 
272275, 
272276, 
272277, 
272278, 
272279, 
272280, 
272281, 
272282, 
272283, 
272284, 
272285, 
272286, 
272287, 
272292, 
272293, 
272294, 
272295, 
272296, 
272297, 
272298, 
272299, 
272300, 
272301, 
272302, 
272303, 
272304, 
272305, 
272306, 
272307, 
272308, 
272309, 
272310, 
272311, 
272315, 
272316, 
272317, 
272318, 
272319, 
272320, 
272321, 
272322, 
272323, 
272324, 
272325, 
272326, 
272327, 
272328, 
272340, 
272341, 
272342, 
272343, 
272344, 
272345, 
272346, 
272347, 
272348, 
272349, 
272350, 
272351, 
272352, 
272353, 
272354, 
272355, 
272356, 
272357, 
272358, 
272359, 
272360, 
272361, 
272362, 
272363, 
272364, 
272365, 
272366, 
272367, 
272368, 
272369, 
272370, 
272371, 
272372, 
272399, 
272400, 
272401, 
272402, 
272403, 
272404, 
272405, 
272406, 
272407, 
272408, 
272409, 
272410, 
272411, 
272412, 
272413, 
272414, 
272415, 
272416, 
272417, 
272418, 
272419, 
272420, 
272421, 
272422, 
272423, 
272424, 
272425, 
272426, 
272427, 
272437, 
272438, 
272439, 
272440, 
272441, 
272442, 
272443, 
272444, 
272445, 
272446, 
272447, 
272448, 
272449, 
272450, 
272451, 
272452, 
272453, 
272454, 
272455, 
272470, 
272471, 
272472, 
272473, 
272474, 
272475, 
272476, 
272477, 
272478, 
272479, 
272480, 
272481, 
272482, 
272483, 
272484, 
272485, 
272486, 
272487, 
272488, 
272489, 
272490, 
272491, 
272492, 
272493, 
272494, 
272495, 
272496, 
272497, 
272498, 
272499, 
272500, 
272501, 
272502, 
272503, 
272504, 
272505, 
272506, 
272507, 
272508, 
272509, 
272510, 
272511, 
272512, 
272513, 
272514, 
272533, 
272542, 
272543, 
272544, 
272545, 
272546, 
272558, 
272559, 
272591, 
272592, 
272606, 
272616, 
272652, 
272696, 
272699, 
272700, 
272701, 
272702, 
272709, 
272710, 
272711, 
272712, 
272713, 
272714, 
272717, 
272723, 
273166, 
273175, 
273182, 
273187, 
273199, 
273201, 
273202, 
273203, 
273204, 
273205, 
273206, 
273207, 
273208, 
273230, 
273232, 
273248, 
273266, 
273267, 
273268, 
273272, 
273278, 
273289, 
273290, 
273291, 
273292, 
273293, 
273294, 
273295, 
273296, 
273297, 
273298, 
273299, 
273301, 
273302, 
273303, 
273304, 
273305, 
273306, 
273307, 
273312, 
273313, 
273314, 
273317, 
273318, 
273319, 
273320, 
273321, 
273322, 
273323, 
273426, 
273427, 
273431, 
273432, 
273446, 
273447, 
273448, 
273449, 
273450, 
273451, 
273452, 
273470, 
273483, 
273487, 
273488, 
273489, 
273490, 
273502, 
273503, 
273508, 
273524, 
273538, 
273551, 
273552, 
273553, 
273554, 
273555, 
273556, 
273557, 
273558, 
273559, 
273560, 
273561, 
273566, 
273567, 
273572, 
273573, 
273574, 
273575, 
273576, 
273577, 
273578, 
273579, 
273587, 
273588, 
273589, 
273590, 
273591, 
273618, 
273619, 
273622, 
273633, 
273638, 
273648, 
273662, 
273664, 
273672, 
273673, 
273677, 
273678, 
273679, 
273680, 
273681, 
273685, 
273686, 
273687, 
273695, 
273701, 
273712, 
273727, 
273728, 
273729, 
273730, 
273731, 
273732, 
273733, 
273734, 
273735, 
273736, 
273737, 
273738, 
273743, 
273749, 
273750, 
273751, 
273773, 
273774, 
273775, 
273779, 
273783, 
273784, 
273785, 
273787, 
273789, 
273795, 
273796, 
273797, 
273798, 
273799, 
273800, 
273801, 
273802, 
273808, 
273809, 
273813, 
273815, 
273816, 
273817, 
273818, 
273822, 
273858, 
273859, 
273860, 
273874, 
273875, 
273883, 
273889, 
273893, 
273894, 
273899, 
273900, 
273901, 
273902, 
273903, 
273904, 
273905, 
273920, 
273926, 
273933, 
273934, 
273944, 
273948, 
273980, 
273987, 
273996, 
273997, 
273998, 
274003, 
274005, 
274007, 
274013, 
274060, 
274061, 
274085, 
274091, 
274097, 
274104, 
274108, 
274117, 
274118, 
274119, 
274120, 
274121, 
274122, 
274123, 
274124, 
274125, 
274126, 
274127, 
274128, 
274129, 
274130, 
274131, 
274143, 
274144, 
274145, 
274149, 
274166, 
274167, 
274168, 
274177, 
274187, 
274191, 
274194, 
274195, 
274196, 
274197, 
274198, 
274199, 
274200, 
274202, 
274203, 
274204, 
274209, 
274210, 
274211, 
274214, 
274215, 
274219, 
274220, 
274223, 
274224, 
274225, 
274226, 
274227, 
274228, 
274229, 
274230, 
274231, 
274232, 
274238, 
274239, 
274240, 
274241, 
274242, 
274243, 
274244, 
274245, 
274246, 
274249, 
274254, 
274258, 
274259, 
274262, 
274263, 
274264, 
274265, 
274390, 
274398, 
274409, 
274410, 
274413, 
274414, 
274415, 
274416, 
274417, 
274418, 
274419, 
274420, 
274421, 
274422, 
274423, 
274424, 
274425, 
274426, 
274427, 
274428, 
274429, 
274430, 
274431, 
274432, 
274433, 
274434, 
274435, 
274436, 
274437, 
274438, 
274439, 
274440, 
274441, 
274442, 
274443, 
274444, 
274445, 
274446, 
274447, 
274448, 
274449, 
274450, 
274458, 
274462, 
274463, 
274464, 
274465, 
274466, 
274467, 
274468, 
274469, 
274470, 
274471, 
274478, 
274479, 
274480, 
274481, 
274482, 
274483, 
274484, 
274485, 
274486, 
274487, 
274488, 
274489, 
274490, 
274491, 
274492, 
274493, 
274494, 
274495, 
274496, 
274497, 
274498, 
274499, 
274500, 
274501, 
274502, 
274507, 
274508, 
274522, 
274523, 
274524, 
274525, 
274526, 
274527, 
274528, 
274529, 
274530, 
274531, 
274532, 
274533, 
274534, 
274536, 
274537, 
274538, 
274539, 
274540, 
274541, 
274542, 
274543, 
274544, 
274545, 
274546, 
274547, 
274553, 
274554, 
274555, 
274557, 
274558, 
274559, 
274560, 
274561, 
274562, 
274564, 
274565, 
274567, 
274568, 
274569, 
274581, 
274582, 
274583, 
274584, 
274585, 
274586, 
274587, 
274588, 
274589, 
274590, 
274591, 
274648, 
274649, 
274650, 
274651, 
274652, 
274653, 
274654, 
274655, 
274656, 
274657, 
274658, 
274659, 
274660, 
274661, 
274662, 
274663, 
274664, 
274665, 
274666, 
274667, 
274668, 
274669, 
274670, 
274671, 
274672, 
274673, 
274674, 
274675, 
274676, 
274677, 
274678, 
274679, 
274680, 
274681, 
274682, 
274683, 
274684, 
274685, 
274686, 
274687, 
274688, 
274689, 
274690, 
274691, 
274692, 
274693, 
274694, 
274695, 
274696, 
274697, 
274698, 
274700, 
274701, 
274702, 
274703, 
274704, 
274705, 
274706, 
274707, 
274708, 
274709, 
274710, 
274711, 
274712, 
274713, 
274714, 
274715, 
274716, 
274717, 
274718, 
274734, 
274735, 
274736, 
274737, 
274741, 
274742, 
274743, 
274744, 
274745, 
274746, 
274747, 
274748, 
274749, 
274750, 
274751, 
274752, 
274753, 
274756, 
274757, 
274759, 
274760, 
274761, 
274762, 
274763, 
274764, 
274765, 
274766, 
274767, 
274768, 
274769, 
274770, 
274771, 
274772, 
274773, 
274774, 
274775, 
274776, 
274777, 
274778, 
274779, 
274780, 
274781, 
274782, 
274783, 
274784, 
274785, 
274786, 
274787, 
274788, 
274789, 
274790, 
274791, 
274792, 
274793, 
274794, 
274795, 
274796, 
274797, 
274798, 
274799, 
274800, 
274801, 
274802, 
274803, 
274804, 
274805, 
274806, 
274807, 
274808, 
274809, 
274810, 
274811, 
274812, 
274813, 
274814, 
274815, 
274816, 
274817, 
274818, 
274819, 
274820, 
274821, 
274822, 
274823, 
274824, 
274825, 
274826, 
274830, 
274831, 
274832, 
274833, 
274834, 
274835, 
274836, 
274837, 
275193, 
275194, 
275197, 
275198, 
275199, 
275200, 
275201, 
275202, 
275203, 
275204, 
275205, 
275206, 
275207, 
275208, 
275209, 
275210, 
275211, 
275212, 
275213, 
275217, 
275218, 
275219, 
275220, 
275221, 
275222, 
275223, 
275224, 
275225, 
275226, 
275227, 
275228, 
275229, 
275230, 
275231, 
275232, 
275256, 
275262, 
275263, 
275264, 
275265, 
275266, 
275267, 
275268, 
275269, 
275270, 
275271, 
275272, 
275273, 
275274, 
275275, 
275276, 
275277, 
275278, 
275279, 
275280, 
275281, 
275287, 
275303, 
275305, 
275322, 
275327, 
275331, 
275332, 
275333, 
275334, 
275344, 
275345, 
275346, 
275347, 
275348, 
275349, 
275350, 
275351, 
275352, 
275353, 
275354, 
275355, 
275356, 
275357, 
275358, 
275359, 
275360, 
275361, 
275362, 
275371, 
275372, 
275378, 
275379, 
275380, 
275381, 
275382, 
275383, 
275384, 
275385, 
275386, 
275391, 
275396, 
275397, 
275470, 
275471, 
275472, 
275490, 
275491, 
275492, 
275493, 
275494, 
275495, 
275496, 
275497, 
275498, 
275499, 
275500, 
275501, 
275502, 
275503, 
275504, 
275505, 
275506, 
275522, 
275525, 
275547, 
275554, 
275555, 
275560, 
275561, 
275575, 
275576, 
275577, 
275578, 
275579, 
275580, 
275581, 
275582, 
275583, 
275584, 
275585, 
275586, 
275587, 
275588, 
275589, 
275590, 
275591, 
275592, 
275593, 
275594, 
275595, 
275596, 
275597, 
275599, 
275600, 
275601, 
275604, 
275605, 
275606, 
275607, 
275608, 
275609, 
275610, 
275611, 
275612, 
275614, 
275616, 
275617, 
275618, 
275619, 
275620, 
275621, 
275622, 
275624, 
275625, 
275628, 
275629, 
275630, 
275631, 
275633, 
275634, 
275635, 
275637, 
275638, 
275639, 
275640, 
275641, 
275642, 
275643, 
275644, 
275645, 
275646, 
275647, 
275648, 
275650, 
275653, 
275654, 
275655, 
275656, 
275659, 
275660, 
275661, 
275663, 
275664, 
275665, 
275666, 
275667, 
275668, 
275669, 
275670, 
275671, 
275672, 
275673, 
275674, 
275675, 
275676, 
275677, 
275678, 
275679, 
275680, 
275681, 
275682, 
275683, 
275684, 
275685, 
275686, 
275687, 
275688, 
275689, 
275690, 
275692, 
275693, 
275694, 
275698, 
275736, 
275742, 
275743, 
275744, 
275745, 
275746, 
275750, 
275753, 
275762, 
275763, 
275764, 
275765, 
275766, 
275767, 
275768, 
275769, 
275770, 
275771, 
275772, 
275778, 
275779, 
275780, 
275783, 
275831, 
275834, 
275835, 
275836, 
275837, 
275860, 
275863, 
275864, 
275865, 
275870, 
275874, 
275881, 
275882, 
275920, 
275923, 
275930, 
275931, 
275940, 
275943, 
275944, 
275949, 
275950, 
275952, 
275953, 
275954, 
275955, 
275956, 
275957, 
275958, 
275959, 
275960, 
275961, 
275962, 
275963, 
276002, 
276014, 
276015, 
276016, 
276017, 
276018, 
276019, 
276020, 
276021, 
276022, 
276023, 
276024, 
276025, 
276026, 
276032, 
276037, 
276040, 
276045, 
276046, 
276047, 
276053, 
276054, 
276055, 
276056, 
276061, 
276092, 
276093, 
276097, 
276124, 
276125, 
276127, 
276128, 
276132, 
276135, 
276136, 
276147, 
276150, 
276152, 
276179, 
276180, 
276181, 
276182, 
276183, 
276184, 
276185, 
276186, 
276187, 
276188, 
276189, 
276190, 
276191, 
276192, 
276193, 
276194, 
276195, 
276196, 
276197, 
276198, 
276199, 
276200, 
276201, 
276202, 
276204, 
276205, 
276206, 
276207, 
276208, 
276209, 
276210, 
276211, 
276212, 
276213, 
276215, 
276216, 
276217, 
276218, 
276219, 
276220, 
276221, 
276320, 
276337, 
276353, 
276358, 
276359, 
276362, 
276363, 
276374, 
276375, 
276376, 
276381, 
276393, 
276397, 
276398, 
276399, 
276400, 
276401, 
276402, 
276403, 
276404, 
276405, 
276406, 
276409, 
276413, 
276414, 
276419, 
276420, 
276425, 
276432, 
276433, 
276434, 
276435, 
276443, 
276444, 
276445, 
276487, 
276488, 
276504, 
276505, 
276506, 
276507, 
276508, 
276509, 
276510, 
276511, 
276512, 
276513, 
276514, 
276535, 
276536, 
276537, 
276538, 
276539, 
276540, 
276541, 
276542, 
276543, 
276547, 
276548, 
276558, 
276566, 
276586, 
276587, 
276588, 
276589, 
276590, 
276621, 
276623, 
276630, 
276633, 
276634, 
276645, 
276646, 
276647, 
276683, 
276684, 
276685, 
276686, 
276687, 
276688, 
276689, 
276690, 
276691, 
276692, 
276693, 
276694, 
276695, 
276696, 
276697, 
276698, 
276699, 
276700, 
276703, 
276707, 
276712, 
276713, 
276714, 
276715, 
276716, 
276717, 
276718, 
276725, 
276726, 
276727, 
276728, 
276729, 
276730, 
276731, 
276732, 
276733, 
276737, 
276760, 
276761, 
276762, 
276763, 
276781, 
276808, 
276982, 
277012, 
277018, 
277026, 
277027, 
277028, 
277029, 
277030, 
277031, 
277032, 
277034, 
277043, 
277046, 
277047, 
277048, 
277049, 
277050, 
277051, 
277052, 
277053, 
277054, 
277055, 
277056, 
277057, 
277058, 
277059, 
277060, 
277061, 
277095, 
277097, 
277104, 
277105, 
277106, 
277107, 
277108, 
277109, 
277110, 
277111, 
277112, 
277113, 
277114, 
277118, 
277150, 
277169, 
277170, 
277171, 
277172, 
277173, 
277180, 
277181, 
277182, 
277183, 
277184, 
277185, 
277186, 
277187, 
277188, 
277189, 
277190, 
277191, 
277192, 
277193, 
277194, 
277195, 
277196, 
277197, 
277198, 
277199, 
277200, 
277201, 
277202, 
277203, 
277204, 
277205, 
277206, 
277207, 
277208, 
277209, 
277210, 
277211, 
277212, 
277213, 
277214, 
277215, 
277216, 
277217, 
277218, 
277219, 
277220, 
277221, 
277222, 
277227, 
277230, 
277235, 
277237, 
277239, 
277268, 
277269, 
277278, 
277279, 
277291, 
277292, 
277293, 
277294, 
277295, 
277296, 
277298, 
277308, 
277309, 
277310, 
277315, 
277329, 
277356, 
277365, 
277366, 
277367, 
277368, 
277369, 
277370, 
277424, 
277425, 
277426, 
277427, 
277428, 
277429, 
277430, 
277431, 
277432, 
277433, 
277434, 
277435, 
277436, 
277437, 
277438, 
277439, 
277440, 
277441, 
277442, 
277443, 
277444, 
277445, 
277446, 
277447, 
277448, 
277449, 
277450, 
277451, 
277465, 
277466, 
277468, 
277469, 
277470, 
277478, 
277482, 
277483, 
277496, 
277497, 
277498, 
277499, 
277501, 
277510, 
277512, 
277513, 
277516, 
277517, 
277581, 
277587, 
277588, 
277589, 
277593, 
277597, 
277607, 
277618, 
277640, 
277641, 
277644, 
277664, 
277671, 
277672, 
277679, 
277680, 
277681, 
277701, 
277705, 
277712, 
277716, 
277717, 
277718, 
277722, 
277723, 
278165, 
278166, 
278168, 
278169, 
278447, 
278448, 
278625, 
280742, 
280743, 
280744, 
280745, 
280746, 
280757, 
280758, 
280765, 
280766, 
280772, 
280773, 
280774, 
280775, 
280784, 
280785, 
280796, 
280797, 
280798, 
280799, 
280800, 
280801, 
280802, 
280803, 
280804, 
280805, 
280811, 
280830, 
280858, 
280859, 
280899, 
280900, 
280911, 
280917, 
280929, 
280935, 
280942, 
280943, 
281137, 
281149, 
281172, 
281173, 
281182, 
281183, 
281184, 
281195, 
281196, 
281203, 
281204, 
281205, 
281206, 
281207, 
281208, 
281215, 
281216, 
281217, 
281238, 
281244, 
281245, 
281260, 
281261, 
281262, 
281263, 
281264, 
281265, 
281266, 
281267, 
281320, 
281324, 
281325, 
281332, 
281333, 
281334, 
281341, 
281342, 
281343, 
281347, 
281352, 
281353, 
281354, 
281355, 
281356, 
281357, 
281358, 
281359, 
281360, 
281361, 
281362, 
281363, 
281364, 
281365, 
281366, 
281367, 
281372, 
281373, 
281378, 
281379, 
281384, 
281385, 
281386, 
281387, 
281388, 
281389, 
281601, 
281608, 
281660, 
281664, 
281665, 
281679, 
281680, 
281681, 
281682, 
281683, 
281684, 
281685, 
281733, 
281734, 
281735, 
281736, 
281737, 
281738, 
281739, 
281740, 
281741, 
281772, 
281777, 
281778, 
281783, 
281791, 
281909, 
281910, 
281917, 
281927, 
281928, 
281929, 
281930, 
281931, 
281937, 
281939, 
281976, 
281982, 
281983, 
281989, 
281994, 
281995, 
281996, 
281997, 
281998, 
281999, 
282000, 
282001, 
282002, 
282003, 
282004, 
282005, 
282006, 
282007, 
282008, 
282012, 
282013, 
282014, 
282015, 
282016, 
282017, 
282018, 
282019, 
282020, 
282021, 
282022, 
282023, 
282024, 
282025, 
282026, 
282027, 
282028, 
282029, 
282030, 
282031, 
282032, 
282033, 
282034, 
282035, 
282036, 
282037, 
282038, 
282039, 
282040, 
282041, 
282042, 
282043, 
282044, 
282045, 
282046, 
282047, 
282048, 
282049, 
282050, 
282051, 
282052, 
282053, 
282054, 
282055, 
282056, 
282057, 
282058, 
282059, 
282060, 
282061, 
282062, 
282063, 
282064, 
282065, 
282066, 
282067, 
282068, 
282071, 
282076, 
282077, 
282078, 
282079, 
282080, 
282081, 
282082, 
282083, 
282084, 
282085, 
282086, 
282087, 
282088, 
282089, 
282090, 
282091, 
282092, 
282093, 
282094, 
282095, 
282096, 
282097, 
282098, 
282099, 
282100, 
282101, 
282102, 
282103, 
282104, 
282105, 
282106, 
282107, 
282108, 
282109, 
282110, 
282111, 
282112, 
282113, 
282114, 
282115, 
282116, 
282117, 
282118, 
282169, 
282189, 
282190, 
282197, 
282198, 
282208, 
282209, 
282210, 
282211, 
282212, 
282213, 
282214, 
282215, 
282216, 
282217, 
282218, 
282219, 
282220, 
282221, 
282227, 
282228, 
282229, 
282230, 
282231, 
282232, 
282233, 
282234, 
282235, 
282236, 
282237, 
282238, 
282239, 
282240, 
282247, 
282249, 
282250, 
282251, 
282269, 
282277, 
282278, 
282279, 
282280, 
282281, 
282282, 
282283, 
282284, 
282287, 
282288, 
282289, 
282290, 
282291, 
282292, 
282293, 
282294, 
282295, 
282296, 
282297, 
282298, 
282299, 
282300, 
282301, 
282302, 
282303, 
282304, 
282305, 
282306, 
282307, 
282308, 
282309, 
282310, 
282311, 
282312, 
282313, 
282314, 
282315, 
282316, 
282317, 
282320, 
282321, 
282322, 
282323, 
282324, 
282325, 
282326, 
282327, 
282328, 
282329, 
282330, 
282331, 
282332, 
282415, 
282422, 
282433, 
282443, 
282456, 
282459, 
282463, 
282467, 
282468, 
282473, 
282474, 
282481, 
282488, 
282522, 
282529, 
282530
    ]

    # Split ticket IDs into batches of manageable size, for example, batches of 100
    batch_size = 100
    all_tickets_data = []

    for i in range(0, len(ticket_ids), batch_size):
        current_batch = ticket_ids[i:i + batch_size]
        logging.info(f"Processing batch {i // batch_size + 1}: Tickets {current_batch[0]} to {current_batch[-1]}")
        extract_merged_tickets(current_batch, all_tickets_data)
        # Add a delay between batches if necessary
        time.sleep(5)

    # Convert all_tickets_data to a pandas DataFrame
    df = pd.DataFrame(all_tickets_data)

    # Save the DataFrame to an Excel file
    output_filename = 'merged_tickets.xlsx'
    df.to_excel(output_filename, index=False)

    print(f"Excel file '{output_filename}' has been generated with the merged ticket details.")
